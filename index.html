<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>äºšé©¬é€Š CGL æ™ºèƒ½ä½“ - æ——èˆ°åˆè§„ç‰ˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #F5F5F7;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .apple-card {
            background: white;
            border-radius: 28px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease;
        }

        .apple-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        }

        .log-window {
            background: #1d1d1f;
            color: #00ff00;
            font-family: ui-monospace, monospace;
            font-size: 11px;
            border-radius: 16px;
            padding: 20px;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
        }

        .scan-line {
            height: 2px;
            background: #0071E3;
            position: absolute;
            width: 100%;
            animation: scan 2s linear infinite;
            box-shadow: 0 0 10px #0071E3;
        }

        @keyframes scan {
            0% {
                top: 0%
            }

            100% {
                top: 100%
            }
        }

        /* éšè—æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ä¸“ä¸šåƒåˆ†å·æ ¼å¼åŒ–
        const fComm = (val) => {
            if (val === undefined || val === null || isNaN(val)) return "0";
            return new Intl.NumberFormat('en-US').format(val);
        };

        const DEFAULT_DB = [
            { id: '11210', cat: 'æ‰‹åŠ¨å·¥å…·', cls: 'B', rate: 0.00065, min: 4500, keywords: 'tap,die,wrench,drill,bit' },
            { id: '10905', cat: 'éé˜²æŠ¤å‹å·¥ä½œæœ', cls: 'B', rate: 0.00065, min: 4500, keywords: 'glove,thermal,work clothes' }
        ];

        function App() {
            const [view, setView] = useState('home');
            const [db, setDb] = useState(() => JSON.parse(localStorage.getItem('cgl_db')) || DEFAULT_DB);
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('cgl_audit_logs')) || []);
            const [exRate, setExRate] = useState(() => parseFloat(localStorage.getItem('cgl_ex_rate')) || 7.2);

            const [revenueRaw, setRevenueRaw] = useState("1,000,000"); // USD
            const [merchantResults, setMerchantResults] = useState([]);
            const [pricingSummary, setPricingSummary] = useState(null);
            const [deductibleType, setDeductibleType] = useState('10000');
            const [coiStep, setCoiStep] = useState('idle');
            const [modalFile, setModalFile] = useState(null);
            const [lastUploadStats, setLastUploadStats] = useState(null);

            const getRevenueNum = () => parseFloat(revenueRaw.replace(/,/g, '')) || 0;

            useEffect(() => {
                localStorage.setItem('cgl_db', JSON.stringify(db));
                localStorage.setItem('cgl_audit_logs', JSON.stringify(logs));
                localStorage.setItem('cgl_ex_rate', exRate);
            }, [db, logs, exRate]);

            const addLog = (type, detail, snapshot = null) => {
                const entry = { id: Date.now(), time: new Date().toLocaleString(), type, detail, snapshot };
                setLogs(prev => [entry, ...prev].slice(0, 50));
            };

            const processMerchantReport = (data) => {
                const revNum = getRevenueNum();
                const matchedItems = data.map(row => {
                    const keys = Object.keys(row);
                    const titleKey = keys.find(k => k.toLowerCase().includes('description')) ||
                        keys.find(k => k.toLowerCase().includes('name')) ||
                        keys.find(k => k.toLowerCase().includes('sku')) || keys[0];
                    const title = row[titleKey] || "æœªçŸ¥å•†å“";

                    const match = db.find(d => d.keywords.split(',').some(k =>
                        String(title).toLowerCase().includes(k.trim().toLowerCase())
                    )) || { id: '10000', cat: 'æ™®é€šç™¾è´§/General MDSE', cls: 'B', rate: 0.00065, min: 4500 };

                    return { title, ...match };
                });

                // æ ¸å¿ƒå®šä»·é€»è¾‘ï¼šä»æ‰€æœ‰åŒ¹é…é¡¹ä¸­æå–æœ€é«˜çš„è´¹ç‡
                const worstMatch = matchedItems.reduce((prev, curr) => (curr.rate > prev.rate) ? curr : prev, matchedItems[0]);

                // è´¹ç‡ä¸Šæµ®é€»è¾‘ (æ— å…èµ”åˆ™ä¸Šæµ® 20%)
                const finalRate = deductibleType === '0' ? worstMatch.rate * 1.2 : worstMatch.rate;
                const finalMinRMB = deductibleType === '0' ? worstMatch.min * 1.2 : worstMatch.min;

                // è®¡ç®—è¯¦æƒ…
                const elasticPremRMB = revNum * finalRate * exRate;
                const totalPremRMB = Math.max(elasticPremRMB, finalMinRMB).toFixed(2);

                setMerchantResults(matchedItems);
                setPricingSummary({
                    worstCat: worstMatch.cat,
                    worstCls: worstMatch.cls,
                    baseRate: worstMatch.rate,
                    appliedRate: finalRate,
                    appliedMin: finalMinRMB,
                    elasticPrem: elasticPremRMB,
                    totalPrem: totalPremRMB,
                    isMinApplied: parseFloat(finalMinRMB) > elasticPremRMB
                });
            };

            const handleMerchantUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const wb = XLSX.read(evt.target.result, { type: 'binary' });
                        const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                        processMerchantReport(data);
                    } catch (err) { alert("è§£æå¤±è´¥"); }
                };
                reader.readAsBinaryString(file);
            };

            const handleAdminUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const wb = XLSX.read(evt.target.result, { type: 'binary' });
                        const raw = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { header: 1 });
                        const headerRow = raw.find(r => r.some(c => String(c).includes('Code') || String(c).includes('è´¹ç‡')));
                        if (!headerRow) { alert("âŒ æœªæ‰¾åˆ°è¡¨å¤´è¡Œ"); return; }
                        const col = {
                            code: headerRow.indexOf('Main Sub Category Code') !== -1 ? headerRow.indexOf('Main Sub Category Code') : 2,
                            name: headerRow.indexOf('Main Sub Category') !== -1 ? headerRow.indexOf('Main Sub Category') : 3,
                            rate: headerRow.indexOf('è´¹ç‡') !== -1 ? headerRow.indexOf('è´¹ç‡') : 6,
                            min: headerRow.indexOf('æœ€ä½ä¿è´¹') !== -1 ? headerRow.indexOf('æœ€ä½ä¿è´¹') : 5
                        };
                        const newDb = raw.slice(raw.indexOf(headerRow) + 1).filter(r => r[col.code]).map(r => ({
                            id: String(r[col.code]), cat: r[col.name] || 'æœªå‘½å', cls: 'B', rate: parseFloat(r[col.rate]) || 0.00065, min: parseFloat(r[col.min]) || 4500, keywords: r[col.name] || ''
                        }));
                        if (newDb.length > 0) {
                            const oldStats = { count: db.length, avgRate: db.reduce((a, b) => a + b.rate, 0) / (db.length || 1) };
                            const newStats = { count: newDb.length, avgRate: newDb.reduce((a, b) => a + b.rate, 0) / newDb.length };
                            const diff = { count: newStats.count - oldStats.count, rateDiff: (((newStats.avgRate - oldStats.avgRate) / (oldStats.avgRate || 1)) * 100).toFixed(2) };
                            setDb(newDb);
                            setLastUploadStats({ ...newStats, diff, fileName: file.name, time: new Date().toLocaleString() });
                            addLog('MASTERè¡¨åŒæ­¥', `æ–‡ä»¶: ${file.name} | æ›´æ–°: ${newDb.length}æ¡`, newDb);
                            alert(`âœ… å·²åŒæ­¥ ${newDb.length} æ¡æŠ¥ä»·è§„åˆ™ã€‚`);
                        }
                    } catch (err) { alert("åŒæ­¥å¤±è´¥"); }
                };
                reader.readAsBinaryString(file);
            };

            return (
                <div className="min-h-screen relative no-scrollbar">
                    <nav className="p-6 bg-white border-b sticky top-0 z-40 flex justify-between items-center px-12">
                        <div className="flex items-center gap-3 cursor-pointer" onClick={() => setView('home')}>
                            <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center text-white font-black">A</div>
                            <h1 className="text-xl font-bold tracking-tight">äºšé©¬é€Š CGL æ™ºèƒ½ä½“</h1>
                        </div>
                        <button onClick={() => setView('admin')} className="text-xs font-bold text-gray-400 hover:text-blue-600 uppercase tracking-widest leading-none">Admin Portal</button>
                    </nav>

                    <main className="max-w-6xl mx-auto p-12">
                        {view === 'home' && (
                            <div className="py-16 space-y-20 animate-in fade-in duration-1000">
                                <div className="space-y-6 text-center">
                                    <h2 className="text-7xl font-black tracking-tighter leading-[0.9]">æ™ºèƒ½åˆ†ç±» <b>å…¨åº—å˜å®š</b></h2>
                                    <p className="text-xl text-gray-400 max-w-2xl mx-auto font-medium">æ”¯æŒå…¨é‡ SKU è‡ªåŠ¨åŒ–é£é™©ç©¿é€ï¼ŒæŒ‰â€œæœ€é«˜é£é™©åŸåˆ™â€è‡ªåŠ¨é”å®šå…¨åº—å¹´åº¦ä¿è´¹ã€‚</p>
                                </div>
                                <div className="grid md:grid-cols-2 gap-10">
                                    <div onClick={() => setView('merchant')} className="apple-card p-16 cursor-pointer group">
                                        <div className="text-4xl mb-8 group-hover:scale-110 transition-transform">ğŸ“Š</div>
                                        <h3 className="text-3xl font-black mb-4">å…¨åº—æŠ¥ä»·åˆ†æ</h3>
                                        <p className="text-gray-400 leading-relaxed">ä¸Šä¼ æ¯æœˆ SKU é”€å”®æŠ¥å‘Šï¼ŒAI è‡ªåŠ¨åˆ¤å®šæœ€é«˜é£é™©ç­‰çº§ï¼Œå®æ—¶è¯•ç®—å¹´åº¦æ€»æˆæœ¬ã€‚</p>
                                    </div>
                                    <div onClick={() => setView('coi')} className="apple-card p-16 cursor-pointer group">
                                        <div className="text-4xl mb-8 group-hover:scale-110 transition-transform">ğŸ›¡ï¸</div>
                                        <h3 className="text-3xl font-black mb-4">COI å‡­è¯é¢„å®¡</h3>
                                        <p className="text-gray-400 leading-relaxed">AI æ£€ç´¢ä¿å•å…³é”®æ¡æ¬¾ï¼Œç¡®ä¿æ»¡è¶³ Amazon $1M é™é¢åŠé™„åŠ è¢«ä¿é™©äººåˆè§„è¦æ±‚ã€‚</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'merchant' && (
                            <div className="space-y-10 animate-in fade-in duration-700">
                                <button onClick={() => setView('home')} className="text-blue-600 font-bold text-sm">â† è¿”å›ä¸»é¡µ</button>

                                <div className="apple-card p-12 space-y-12">
                                    <div className="grid md:grid-cols-3 gap-8">
                                        <div className="md:col-span-2 space-y-4">
                                            <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">è¯¥è´¦æˆ·å…¨åº—é¢„è®¡å¹´åº¦æ€»é”€å”®é¢ (Total Annual Revenue)</label>
                                            <div className="relative">
                                                <span className="absolute left-6 top-1/2 -translate-y-1/2 text-gray-300 font-bold text-3xl">$</span>
                                                <input type="text" className="w-full pl-16 pr-8 py-6 rounded-[28px] bg-gray-50 border-none font-black text-4xl text-gray-900 focus:bg-white focus:ring-8 focus:ring-blue-500/5 outline-none transition-all" value={revenueRaw} onChange={e => setRevenueRaw(fComm(e.target.value.replace(/[^0-9]/g, '')))} />
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                            <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">å…èµ”é¢æ§åˆ¶ (Deductible)</label>
                                            <select className="w-full p-6 h-[88px] rounded-[28px] bg-gray-50 border-none font-black text-xl text-gray-900 focus:bg-white outline-none transition-all appearance-none cursor-pointer shadow-sm" value={deductibleType} onChange={e => setDeductibleType(e.target.value)}>
                                                <option value="10000">10,000 ç¾é‡‘ (å¸¸è§„)</option>
                                                <option value="0">æ— å…èµ” (Nil)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="border-2 border-dashed border-gray-100 rounded-[40px] p-20 text-center hover:bg-blue-50/20 hover:border-blue-400 transition-all relative group">
                                        <input type="file" className="absolute inset-0 opacity-0 cursor-pointer z-10" onChange={handleMerchantUpload} />
                                        <div className="space-y-4">
                                            <div className="text-5xl group-hover:scale-110 transition-transform">ğŸ“¤</div>
                                            <h4 className="text-xl font-black">æ”¾å…¥åº—å†…æ‰€æœ‰è®¡åˆ’æŠ•ä¿çš„ SKU é£é™©åˆ†ç±»è¡¨</h4>
                                            <p className="text-gray-400 font-medium">ç³»ç»Ÿå°†è‡ªåŠ¨æå–åº—å†…æœ€é«˜é£é™©é¡¹è¿›è¡Œå…¨é‡ä¿è´¹å¯¹å†²</p>
                                        </div>
                                    </div>

                                    {pricingSummary && (
                                        <div className="space-y-12 animate-in slide-in-from-bottom-6 duration-700">
                                            <div className="relative group">
                                                <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-[48px] blur-2xl opacity-20 transition duration-1000"></div>
                                                <div className="relative bg-[#1d1d1f] p-12 rounded-[48px] text-white flex flex-col md:flex-row justify-between items-center gap-8">
                                                    <div className="space-y-4 flex-1">
                                                        <div className="inline-block px-3 py-1 bg-blue-500/20 text-blue-400 text-[10px] font-black rounded-full uppercase tracking-widest">Storewide Annual Obligation</div>
                                                        <div className="flex items-baseline gap-3">
                                                            <span className="text-4xl font-bold text-white/40">Â¥</span>
                                                            <span className="text-[100px] font-black leading-none tracking-tighter tabular-nums">{fComm(pricingSummary.totalPrem)}</span>
                                                        </div>
                                                        <div className="space-y-2">
                                                            <p className="text-white/60 font-bold flex items-center gap-2">
                                                                <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                                                                è®¡ç®—é€»è¾‘ï¼šå…¨åº—é¢„æµ‹ ${revenueRaw} x æœ€é«˜è´¹ç‡ {(pricingSummary.appliedRate * 100).toFixed(3)}% x æ±‡ç‡ {exRate}
                                                            </p>
                                                            {pricingSummary.isMinApplied && (
                                                                <p className="text-orange-400 font-black text-xs uppercase tracking-widest">âš ï¸ å¼¹æ€§è¯•ç®—é¢ä½äºä¿åº•ï¼Œå½“å‰å·²æŒ‰æœ€ä½ä¿è´¹ Â¥{fComm(pricingSummary.appliedMin)} è®¡æ”¶</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="bg-white/5 p-8 rounded-[36px] min-w-[320px] space-y-4 border border-white/10">
                                                        <p className="text-[10px] text-white/40 font-black uppercase tracking-widest border-b border-white/10 pb-4 mb-4">Risk Factor Analysis (è´¹ç‡é©±åŠ¨æº)</p>
                                                        <div>
                                                            <p className="text-[10px] text-blue-400 font-black uppercase">å…¨åº—é£é™©å®šçº§</p>
                                                            <p className="text-2xl font-black">Class {pricingSummary.worstCls}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-[10px] text-blue-400 font-black uppercase">ä¸»è¦é£é™©ç±»ç›®</p>
                                                            <p className="text-lg font-bold leading-tight">{pricingSummary.worstCat}</p>
                                                        </div>
                                                        <div className="pt-4 flex justify-between items-end border-t border-white/10">
                                                            <div><p className="text-[10px] text-white/40 font-black uppercase">æŠ¥ä»·æ±‡ç‡</p><p className="font-bold">{exRate}</p></div>
                                                            <div className="text-right"><p className="text-[10px] text-white/40 font-black uppercase">é€‚ç”¨å…èµ”</p><p className="font-bold">{deductibleType === '0' ? 'Nil' : '$10K'}</p></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-6">
                                                <div className="flex items-center gap-4 border-b pb-6">
                                                    <h4 className="text-2xl font-black tracking-tight text-gray-900">åº—å†…äº§å“é£é™©å½’ç±»æ¸…å• ({merchantResults.length} SKUs)</h4>
                                                </div>
                                                <div className="overflow-x-auto no-scrollbar">
                                                    <table className="w-full text-xs text-left">
                                                        <thead>
                                                            <tr className="text-gray-400 font-black uppercase tracking-widest border-b">
                                                                <th className="pb-6 px-4">ITEM / SKU TITLE</th>
                                                                <th className="pb-6 px-4">MATCHED CATEGORY</th>
                                                                <th className="pb-6 px-4 text-center">CLASS</th>
                                                                <th className="pb-6 px-4 text-right">BASE RATE (USD)</th>
                                                                <th className="pb-6 px-4 text-right">MIN PREM (RMB)</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y">
                                                            {merchantResults.map((r, i) => (
                                                                <tr key={i} className="hover:bg-blue-50/50 transition-colors">
                                                                    <td className="py-6 px-4 font-bold text-gray-500 max-w-[300px] truncate">{r.title}</td>
                                                                    <td className="py-6 px-4 font-black text-gray-900">{r.cat}</td>
                                                                    <td className="py-6 px-4 text-center">
                                                                        <span className={`px-2.5 py-1 rounded-md text-[10px] font-black ${r.cls === 'C' ? 'bg-orange-100 text-orange-700' : 'bg-blue-50 text-blue-700'}`}>{r.cls}</span>
                                                                    </td>
                                                                    <td className="py-6 px-4 text-right font-mono font-bold text-gray-400">{(r.rate * 100).toFixed(3)}%</td>
                                                                    <td className="py-6 px-4 text-right font-bold text-gray-400">Â¥{fComm(r.min)}</td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {view === 'admin' && (
                            <div className="max-w-5xl mx-auto space-y-10 animate-in fade-in duration-700">
                                <button onClick={() => setView('home')} className="text-blue-600 font-bold text-sm">â† è¿”å›é¦–é¡µ</button>
                                <div className="grid md:grid-cols-3 gap-8 text-left">
                                    <div className="md:col-span-2 apple-card p-12 space-y-10 border-2 border-blue-500/20">
                                        <div className="flex justify-between items-center">
                                            <h3 className="text-3xl font-black text-gray-900 tracking-tight">å‚æ•°ç»´æŠ¤ä¸­å¿ƒ</h3>
                                            <span className="px-3 py-1 bg-black text-white text-[10px] font-black rounded-full uppercase tracking-widest">Secure Access</span>
                                        </div>
                                        <div className="grid md:grid-cols-2 gap-8">
                                            <div className="space-y-4">
                                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">æ ‡å‡†ç»“ç®—æ±‡ç‡ (USD/CNY)</label>
                                                <input type="number" step="0.0001" className="w-full p-6 rounded-[24px] bg-gray-50 border-none font-black text-2xl text-blue-600 outline-none" value={exRate} onChange={e => setExRate(e.target.value)} />
                                            </div>
                                            <div className="space-y-4">
                                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">æ›´æ–° à¤®à¤¾à¤¸à¥à¤Ÿà¤°æŠ¥ä»·é€»è¾‘ (.xlsx)</label>
                                                <div className="h-[88px] border-2 border-dashed border-gray-100 rounded-[24px] flex items-center justify-center bg-gray-50 relative hover:border-blue-400 transition-all cursor-pointer">
                                                    <input type="file" onChange={handleAdminUpload} className="absolute inset-0 opacity-0 cursor-pointer" />
                                                    <span className="text-sm font-black text-gray-400">ç‚¹å‡»åŒæ­¥æœ€æ–°åˆ†ç±»ä¸è´¹ç‡</span>
                                                </div>
                                            </div>
                                        </div>
                                        {lastUploadStats && (
                                            <div className="p-8 bg-blue-50/50 rounded-[32px] border border-blue-100 animate-in slide-in-from-top-4 overflow-hidden">
                                                <h4 className="text-sm font-black text-blue-600 mb-4 uppercase tracking-widest">æœ€è¿‘åŒæ­¥æ‘˜è¦ï¼š{lastUploadStats.fileName}</h4>
                                                <div className="grid grid-cols-3 gap-6">
                                                    <div><p className="text-[10px] text-gray-400 font-bold uppercase">æ¡ç›®æ•°</p><p className="text-2xl font-black">{fComm(lastUploadStats.count)}æ¡</p></div>
                                                    <div><p className="text-[10px] text-gray-400 font-bold uppercase">å¹³å‡å˜åŠ¨</p><p className="text-2xl font-black">{lastUploadStats.diff.rateDiff}%</p></div>
                                                    <div><p className="text-[10px] text-gray-400 font-bold uppercase">åŒæ­¥æ—¶é—´</p><p className="text-sm font-bold opacity-40 leading-none mt-2">{lastUploadStats.time}</p></div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    <div className="apple-card p-10 bg-gray-900 text-white flex flex-col justify-between">
                                        <p className="text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-8">System Telemetry</p>
                                        <div className="space-y-8">
                                            <div><p className="text-xs opacity-40">æœ‰æ•ˆè§„åˆ™åº“</p><p className="text-4xl font-black tabular-nums">{db.length}</p></div>
                                            <div><p className="text-xs opacity-40">å®¡è®¡æ—¥å¿—</p><p className="text-4xl font-black tabular-nums">{logs.length}</p></div>
                                        </div>
                                        <p className="mt-8 text-[10px] italic text-blue-400 font-bold">åå°è¿æ¥å·²åŠ å¯†ã€‚æ‰€æœ‰å˜åŠ¨å‡ä¸ºåŸå­åŒ–å†™å…¥ã€‚</p>
                                    </div>
                                </div>

                                <div className="log-window no-scrollbar">
                                    <p className="text-[10px] text-gray-500 mb-8 font-black uppercase tracking-[0.4em] text-center border-b border-white/5 pb-6">Audit Trail Ecosystem - å…¨é‡å®¡è®¡æº¯æº</p>
                                    <div className="space-y-4 max-h-[500px] overflow-y-auto px-4 no-scrollbar">
                                        {logs.map(log => (
                                            <div key={log.id} className="flex justify-between items-center py-4 border-b border-white/5">
                                                <div className="space-y-1">
                                                    <span className="text-blue-500 font-black text-[9px] uppercase tracking-widest bg-blue-500/10 px-2 py-0.5 rounded-full">{log.type}</span>
                                                    <p className="text-white/70 text-sm font-medium">{log.detail}</p>
                                                    <p className="text-white/20 text-[9px] tabular-nums">{log.time}</p>
                                                </div>
                                                {log.snapshot && <button onClick={() => setModalFile(log)} className="text-[9px] font-black uppercase tracking-widest text-white/40 hover:text-white transition-colors">View Snapshot</button>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {modalFile && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-12 modal-overlay" onClick={() => setModalFile(null)}>
                            <div className="bg-white w-full max-w-5xl max-h-full rounded-[56px] shadow-2xl overflow-hidden flex flex-col animate-in zoom-in duration-300" onClick={e => e.stopPropagation()}>
                                <div className="p-12 border-b flex justify-between items-center bg-gray-50">
                                    <div><h4 className="font-black text-3xl">å†å²æŠ¥ä»·é€»è¾‘å¿«ç…§</h4></div>
                                    <button onClick={() => setModalFile(null)} className="text-4xl rotate-45 hover:scale-125 transition-transform">ï¼‹</button>
                                </div>
                                <div className="flex-1 overflow-auto p-12 no-scrollbar">
                                    <table className="w-full text-xs text-left">
                                        <thead className="bg-black text-white"><tr><th className="p-4 border-r border-white/10 uppercase">Code</th><th className="p-4 border-r border-white/10 uppercase">Category</th><th className="p-4 border-r border-white/10 text-center uppercase">Rate</th><th className="p-4 text-right uppercase">Min</th></tr></thead>
                                        <tbody className="divide-y">{modalFile.snapshot.map((row, i) => (<tr key={i} className="hover:bg-gray-50"><td className="p-4 font-black">{row.id}</td><td className="p-4 font-bold">{row.cat}</td><td className="p-4 font-mono text-center text-blue-600 font-black">{row.rate}</td><td className="p-4 text-right font-black">Â¥{fComm(row.min)}</td></tr>))}</tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>